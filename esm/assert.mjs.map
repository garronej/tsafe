{"version":3,"file":"assert.mjs","sources":["../dist/src/assert.ts"],"sourcesContent":["import { overwriteReadonlyProp } from \"./lab/overwriteReadonlyProp\";\nexport type { Equals } from \"./Equals\";\n\n/** https://docs.tsafe.dev/assert#error-thrown */\nexport class AssertionError extends Error {\n    originalMessage?: string;\n\n    constructor(msg: string | undefined) {\n        super(`Wrong assertion encountered` + (!msg ? \"\" : `: \"${msg}\"`));\n\n        this.originalMessage = msg;\n\n        Object.setPrototypeOf(this, new.target.prototype);\n\n        if (!this.stack) {\n            return;\n        }\n\n        try {\n            overwriteReadonlyProp(\n                this,\n                \"stack\",\n                this.stack\n                    .split(\"\\n\")\n                    .filter((...[, i]) => i !== 1 && i !== 2)\n                    .join(\"\\n\"),\n            );\n        } catch {}\n    }\n}\n\nlet refOfIs: undefined | Record<string, never> = undefined;\n\n/** https://docs.tsafe.dev/assert */\nexport function assert<_T extends true>(\n    condition?: any,\n    msg?: string | (() => string),\n): asserts condition {\n    if (arguments.length === 0) {\n        condition = true;\n    }\n    if (refOfIs !== undefined) {\n        refOfIs = undefined;\n        return;\n    }\n\n    if (!condition) {\n        throw new AssertionError(typeof msg === \"function\" ? msg() : msg);\n    }\n}\n\nconst errorMessage = \"Wrong usage of the `is` function refer to https://docs.tsafe.dev/is\";\n\n/** https://docs.tsafe.dev/is */\nexport function is<T>(value: any): value is T {\n    const ref = {};\n\n    if (refOfIs !== undefined) {\n        refOfIs = undefined;\n        throw new Error(errorMessage);\n    }\n\n    refOfIs = ref;\n\n    Promise.resolve().then(() => {\n        if (refOfIs === ref) {\n            throw new Error(errorMessage);\n        }\n    });\n\n    return null as any;\n}\n"],"names":[],"mappings":";;AAGA;AACM,MAAO,cAAe,SAAQ,KAAK,CAAA;AAGrC,IAAA,WAAA,CAAY,GAAuB,EAAA;AAC/B,QAAA,KAAK,CAAC,CAA6B,2BAAA,CAAA,IAAI,CAAC,GAAG,GAAG,EAAE,GAAG,CAAA,GAAA,EAAM,GAAG,CAAG,CAAA,CAAA,CAAC,CAAC,CAAC;AAElE,QAAA,IAAI,CAAC,eAAe,GAAG,GAAG,CAAC;QAE3B,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAElD,QAAA,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;YACb,OAAO;SACV;AAED,QAAA,IAAI;AACA,YAAA,qBAAqB,CACjB,IAAI,EACJ,OAAO,EACP,IAAI,CAAC,KAAK;iBACL,KAAK,CAAC,IAAI,CAAC;AACX,iBAAA,MAAM,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACxC,iBAAA,IAAI,CAAC,IAAI,CAAC,CAClB,CAAC;SACL;QAAC,MAAM,GAAE;KACb;AACJ,CAAA;AAED,IAAI,OAAO,GAAsC,SAAS,CAAC;AAE3D;AACgB,SAAA,MAAM,CAClB,SAAe,EACf,GAA6B,EAAA;AAE7B,IAAA,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;QACxB,SAAS,GAAG,IAAI,CAAC;KACpB;AACD,IAAA,IAAI,OAAO,KAAK,SAAS,EAAE;QACvB,OAAO,GAAG,SAAS,CAAC;QACpB,OAAO;KACV;IAED,IAAI,CAAC,SAAS,EAAE;AACZ,QAAA,MAAM,IAAI,cAAc,CAAC,OAAO,GAAG,KAAK,UAAU,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC;KACrE;AACL,CAAC;AAED,MAAM,YAAY,GAAG,qEAAqE,CAAC;AAE3F;AACM,SAAU,EAAE,CAAI,KAAU,EAAA;IAC5B,MAAM,GAAG,GAAG,EAAE,CAAC;AAEf,IAAA,IAAI,OAAO,KAAK,SAAS,EAAE;QACvB,OAAO,GAAG,SAAS,CAAC;AACpB,QAAA,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;KACjC;IAED,OAAO,GAAG,GAAG,CAAC;AAEd,IAAA,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,MAAK;AACxB,QAAA,IAAI,OAAO,KAAK,GAAG,EAAE;AACjB,YAAA,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;SACjC;AACL,KAAC,CAAC,CAAC;AAEH,IAAA,OAAO,IAAW,CAAC;AACvB;;;;"}